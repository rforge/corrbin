{
    "contents" : "\\documentclass[12pt]{article}\n\\usepackage[margin=1in]{geometry}\n\\usepackage{setspace}\n\\usepackage{amsmath, amsthm, amssymb}\n\\usepackage[pdftex]{graphicx}\n\\usepackage{enumerate}\n\\usepackage{natbib}\n\\usepackage{url} % not crucial - just used below for the URL\n\n\\newcommand{\\pvec}{\\mathbf{p}}\n\\newcommand{\\Xvec}{\\mathbf{X}}\n\\newcommand{\\muvec}{\\mathbf{\\mu}}\n\\newcommand{\\zerovec}{\\mathbf{0}}\n\\newcommand{\\onevec}{\\mathbf{1}}\n\\newcommand{\\Imat}{\\mathbf{I}}\n\\newcommand{\\setJ}{\\mathcal{J}}\n\\providecommand{\\dsum}{\\displaystyle\\sum}\n\\def\\T{{ \\mathrm{\\scriptscriptstyle T} }}\n\\DeclareMathOperator{\\Cov}{Cov}\n\\DeclareMathOperator{\\Var}{Var}\n\\DeclareMathOperator{\\E}{E}\n\\DeclareMathOperator{\\diag}{diag}\n\\DeclareMathOperator{\\rank}{rank}\n\n\\newtheorem{theorem}{Theorem}\n\\newtheorem{corollary}{Corollary}\n\n%\\pdfminorversion=4\n% NOTE: To produce blinded version, replace \"0\" with \"1\" below.\n%\\newcommand{\\blind}{0}\n\\newif\\ifblind\n\\blindtrue\n\n%% DON'T change margins - should be 1 inch all around.\n%\\addtolength{\\oddsidemargin}{-.5in}%\n%\\addtolength{\\evensidemargin}{-.5in}%\n%\\addtolength{\\textwidth}{1in}%\n%\\addtolength{\\textheight}{1.3in}%\n%\\addtolength{\\topmargin}{-.8in}%\n\n\n\\begin{document}\n\n%\\def\\spacingset#1{\\renewcommand{\\baselinestretch}%\n%{#1}\\small\\normalsize} \\spacingset{1}\n\\singlespacing\n\n\n%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n\n%\\ifblind\n%{\n%  \\bigskip\n%  \\bigskip\n%  \\bigskip\n%  \\begin{center}\n%    {\\LARGE\\bf Test for trend with a multinomial outcome}\n%    \\end{center}\n%  \\medskip\n%}\n%\\else\n%{\n%  \\title{\\bf Test for trend with a multinomial outcome}\n%  \\author{Aniko Szabo\n%    Institute for Health and Society, Medical College of Wisconsin}\n%  \\maketitle\n%}\n%\\fi\n\n\n\\title{\\bf Test for trend with a multinomial outcome}\n\\ifblind\\author{Aniko Szabo\\\\    Institute for Health and Society, Medical College of Wisconsin}\n\\else\\author{}\n\\fi\n\\date{}\n\\maketitle\n\n\\bigskip\n\\begin{abstract}% 200 or fewer words.\nThere is no established procedure for testing for trend with nominal outcomes that would provide both a global hypothesis test and outcome-specific inference. We derive a simple formula for such a test using a weighted sum of Cochran--Armitage test statistics evaluating the trend in each outcome separately. The test is shown to be equivalent to the score test for multinomial logistic regression, and, with\nappropriate choice of scores, to the Kruskal--Wallis test. The new formulation enables the derivation of a sample size formulas and multiplicity-adjusted inference for individual outcomes. Extensions to clustered and survey-weighted data are discussed.\n\n\\end{abstract}\n\n\\noindent%\n{\\it Keywords:}  Mean score test; Cochran--Armitage test; Kruskal--Wallis test; multiple testing\n\\vfill\n\n\\newpage\n%\\spacingset{1.45} % DON'T change the spacing!\n\\setstretch{1.45}\n\\section{Introduction}\n\\label{sec:intro}\nThe study by \\citet{Nakajima14} of stroke patients over a 9-year period\n% latex table generated in R 3.1.2 by xtable 1.7-4 package\n% Tue Mar 10 09:08:11 2015\n\\begin{table}[ht]\n\\caption{Number of stroke patients with specific etiologies by year. Data extracted from~\\citet{Nakajima14}}\\label{T:stroke}\n\\begin{tabular}{rrrrrrrrrr}\n  \\hline\n & 2003 & 2004 & 2005 & 2006 & 2007 & 2008 & 2009 & 2010 & 2011 \\\\\n  \\hline\nSmall vessel occlusion &  53 &  97 &  77 & 118 & 104 & 106 &  98 & 107 &  94 \\\\\n  Large artery atherosclerosis &  43 &  40 &  49 &  60 &  80 &  62 &  67 &  72 &  47 \\\\\n  Cardioembolism &  97 &  94 & 117 &  98 & 110 & 118 &  93 &  80 &  74 \\\\\n  Other determined aetiology &  11 &   5 &   4 &   8 &  13 &   8 &  14 &  17 &  29 \\\\\n  Undetermined aetiology &  45 &  53 &  63 &  55 &  65 &  52 &  72 &  77 &  67 \\\\\n   \\hline\n   Total  & 249 & 289 & 310 & 339 & 372 & 346 & 344 & 353 & 311\\\\\n\\end{tabular}\n\\end{table}\n\\begin{figure}\n  \\includegraphics{StrokeTrend}\n\\caption{Trends in the distribution of stroke etiology over time. }\\label{F:stroke}\n\\end{figure}\n\n\\section{Multinomial trend test}\n\\subsection{Notation}\nConsider a study in which a multinomial outcome with $K$ possible unordered values is measured in subjects belonging to one of $G$ ordered groups.\nThe size of each group, $n_{i\\cdot}$, is defined by the study design, and will be treated as fixed.\nLet $\\pvec_i=(p_{i1},\\ldots,p_{iK})^\\T$ denote the probabilities of the multinomial outcomes in the $i$th group. The hypothesis of interest is to\nevaluate the homogeneity of these probabilities across the groups with a targeted alternative of a trend in at least one of the categories.\nFormally, we consider testing $H_0 = \\bigcap_{j=1}^K H_{0j}$ versus $H_1 = \\bigcup_{j=1}^K H_{1j}$, where\n\\begin{equation}\n\\begin{aligned}\n  H_{0j}& :  p_{1j}=\\cdots = p_{Gj} \\\\\n  H_{1j}& : p_{1j} \\leq \\cdots \\leq p_{Gj} \\text{ or }  p_{1j} \\geq \\cdots \\geq p_{Gj} \\text{ with at least one inequality}\n\\end{aligned}\n\\end{equation}\n\n\nThe proposed test statistic will build on marginal application of the Cochran--Armitage trend (CAT) test \\citep{Armitage55,Cochran54}. This test requires choosing a score $c_i$ for each group $i=1,\\ldots, G$, where the choice of the scores changes the power of the test to detect trends of various shapes. The most common choice is $c_i=i$, which results in a test for linear trend.  Let $n_{ij}$, $i=1,\\ldots, G$; $j=1,\\ldots,K$ denote the number of subjects with outcome type $j$ in the $i$th group.  With these notations, the CAT statistic for testing for trend in the $j$th category is\n\\begin{equation}\n  T_j = \\frac{\\sum_{i=1}^G n_{ij}(c_i-\\bar{c})}{\\sqrt{p_{\\cdot j}(1-p_{\\cdot j})s^2}},\n\\end{equation}\nwhere $\\bar{c} = \\sum_{i=1}^G n_{i\\cdot}c_i \\big/ N$, $n_{i\\cdot}=\\sum_{j=1}^K n_{ij}$, $N=\\sum_{i=1}^G n_{i\\cdot}$,  $s^2 = \\sum_{i=1}^G n_{i\\cdot}(c_i-\\bar{c})$, and $p_{\\cdot j}$ is the common value of the probabilities $p_{ij}$, $i=1,\\ldots,K$ under $H_{0j}$. Under $H_{0j}$,  $T_j$ has an asymptotically standard normal distribution as $N\\rightarrow\\infty$, while $T_j^2$ has an asymptotically $\\chi^2_1$ distribution.\n\n\\subsection{Main result}\n\n\n\\begin{theorem}[Multinomial trend test]\\label{Th:multitrend}\nUnder $H_0=\\bigcap_{j=1}^K H_{0j}$ as $N\\rightarrow\\infty$\n\\begin{equation}\\label{E:multitrend}\n  W = \\sum_{j=1}^K (1-p_{\\cdot j})T^2_j \\xrightarrow{d} \\chi^2_{K-1}.\n\\end{equation}\n\\end{theorem}\n\n\\begin{proof}\nLet $X_j = \\sum_{i=1}^K n_{ij}(c_i-\\bar{c})$ for $j=1,\\ldots, K$. The distribution of outcomes in study group $i$ follows a multinomial distribution with parameters $n_{i\\cdot}$, $\\pvec_i$, that is independent from the other groups, so\n\\begin{equation}\\label{E:MeanCov}\n  \\begin{aligned}\n    \\E(X_j) = & \\sum_{i=1}^K n_{i\\cdot}p_{ij}(c_i-\\bar{c});\\\\\n    \\Var(X_j) = & \\sum_{i=1}^K n_{i\\cdot}p_{ij}(1-p_{ij})(c_i-\\bar{c})^2;\\\\\n    \\Cov(X_j, X_m) = &   -\\sum_{i=1}^K n_{i\\cdot}p_{ij}p_{im}(c_i-\\bar{c})^2.\n  \\end{aligned}\n\\end{equation}\nUnder the null hypothesis $H_0$, for $j,m=1,\\ldots, K$ we have $\\E(X_j) = p_{\\cdot j}\\sum_{i=1}^K n_{i\\cdot}(c_i-\\bar{c}) = 0$ and\n$\\Cov(X_j, X_m) =  -p_{\\cdot j}p_{\\cdot m}\\sum_{i=1}^K n_{i\\cdot}(c_i-\\bar{c})^2 = -p_{\\cdot j}p_{\\cdot m} s^2$. Rewriting this in matrix form, and using the asymptotic normality of the multinomial distribution, under $H_{0}$ we have\n\\begin{equation}\\label{E:mvnorm}\n  \\Xvec \\xrightarrow{d} N\\big(\\zerovec_K, s^2 [\\diag(\\pvec) - \\pvec\\pvec^\\T]\\big),\n\\end{equation}\nwhere  $\\Xvec= (X_{1}, \\ldots, X_{K})^\\T$, $\\pvec = (p_{\\cdot 1}, \\ldots, p_{\\cdot K})^\\T$, and $\\zerovec_K$ is the zero vector of length $K$.\n\n Based on classical quadratic form results\n\\citep[Theorem 9.9]{Schott97}, $W = \\frac{1}{s^2}\\Xvec^\\T [\\diag(\\pvec) - \\pvec\\pvec^\\T]^{+} \\Xvec$, where $A^+$ denotes the generalized inverse of $A$, has an\nasymptotically chi-squared distribution with $\\rank [\\diag(\\pvec) - \\pvec\\pvec^\\T] = K-1$ degrees of freedom.\n\n\\Citet{Tanabe92} have shown that the generalized inverse $[\\diag(\\pvec) - \\pvec\\pvec^\\T]^{+} = \\big(\\Imat - \\frac{1}{K}\\onevec\\onevec^\\T\\big) \\diag(\\pvec)^{-1} \\big(\\Imat - \\frac{1}{K}\\onevec\\onevec^\\T\\big)$, where  $\\Imat$ is the $K\\times K$ identity matrix, and $\\onevec$ is the vector of ones of length $K$. Since $\\Xvec^\\T\\onevec = \\sum_{j=1}^K\\sum_{i=1}^K  n_{ij}(c_i-\\bar{c}) = \\sum_{i=1}^K  n_{i\\cdot}(c_i-\\bar{c}) = 0$ from the definition of $\\bar{c}$,\n\\begin{align*}\nW = &\\frac{1}{s^2}\\Xvec^\\T\\big(\\Imat - \\frac{1}{K}\\onevec\\onevec^\\T\\big) \\diag(\\pvec)^{-1} \\big(\\Imat - \\frac{1}{K}\\onevec\\onevec^\\T\\big) \\Xvec =\n \\frac{1}{s^2}\\Xvec^\\T  \\diag(\\pvec)^{-1} \\Xvec\\\\\n  = &\\frac{1}{s^2}\\sum_{j=1}^K\\frac{X_j^2}{p_{\\cdot j}} =  \\frac{1}{s^2}\\sum_{j=1}^K (1-p_{\\cdot j}) T^2_j,\n\\end{align*}\nthus proving the statement.\n\\end{proof}\n\nExpression~\\eqref{E:multitrend} provides a test statistic that is easy to explain as a combination of evidence for trend for each individual outcome, and it is clearly symmetric with respect to the outcome with no artificial `reference group' choice required. If there are only two groups ($K=2$), then $p_{\\cdot 2} = 1 - p_{\\cdot 1}$ and $T_1 = -T_2$, so the multinomial trend test statistic reduces to the Cochran--Armitage trend test.\n\nTable~\\ref{T:strkres} shows the values of estimated outcome probabilities under the null hypothesis $\\hat{p}_{\\cdot j} = \\sum_{i=1}^G n_{ij} \\big/ N$, and the CAT test statistics $T_j$ for the stroke data. To evaluate the overall evidence for trend over time, we compute the test statistic $W=(1-0.293)\\times (1.20)^2 + \\cdots + (1-0.188)\\times (1.49)^2 = 40.07$, and evaluate its statistical significance using the $\\chi^2_4$ distribution to obtain $p=P(\\chi^2_4 > 40.07) =  4.2 \\times 10^{-8}$. We can conclude that there is evidence for trend over time for at least one of the stroke categories.\n\n\n\\subsection{Tests for individual outcomes}\nIn addition to an overall test, researchers are often interested in  inference about specific outcomes with appropriate adjustment for multiple testing. There are several possible approaches for deriving such simultaneous tests or, equivalently, multiplicity-adjusted  p-values. While a maxT type single-step procedure \\citep{Roy53} based on the multivariate normal distribution of $\\Xvec$ as shown in~\\eqref{E:mvnorm} is a possibility, we concentrate on step-down approaches as they are more powerful compared to single-step procedures. Thus, we will develop step-down closed testing procedure \\citep{Marcus76} and a modification of Holm's procedure as suggested by \\citet{Shaffer86}, both of which can incorporate the logical constraints on the set of all hypotheses.\n\n\\paragraph{Closed testing}\nA closed testing procedure requires considering the closure of the hypotheses of interest, that is the set of all possible intersection hypotheses $H_{0\\setJ} = \\bigcap_{j\\in\\setJ}H_{0j}$, where $\\setJ \\subset \\{1,\\ldots,K\\}$, and obtaining a test for each such hypothesis. The following theorem provides a basis for such a test.\n\n\\begin{theorem}\\label{Th:partial}\nLet $\\setJ \\subsetneq \\{1,\\ldots,K\\}$, then under $H_{0\\setJ}=\\bigcap_{j\\in\\setJ}H_{0j}$ as $N\\rightarrow\\infty$\n\\begin{equation}\n  W_\\setJ =  \\sum_{j\\in\\setJ} (1-p_{\\cdot j})T^2_j + \\big(\\sum_{j\\in\\setJ} p_{\\cdot j}\\big) T^2_\\setJ \\xrightarrow{d} \\chi^2_{|\\setJ|},\n\\end{equation}\nwhere $T_\\setJ = [\\sum_{i=1}^G \\sum_{j\\in\\setJ}n_{ij}(c_i-\\bar{c})] \\big/ \\sqrt{p_{\\cdot \\setJ}(1-p_{\\cdot \\setJ})s^2}$ denotes the Cochran-Armitage trend test statistic for testing for marginal trend in $p_{i\\setJ}=\\sum_{j\\in\\setJ}p_{ij}$, $i=1,\\ldots, G$.\n\\end{theorem}\n\\begin{proof}\nUsing the notations of Theorem~\\ref{Th:multitrend} and a similar multivariate normal approximation of the multinomial distribution,\nunder $H_{0\\setJ}$ we have\n\\begin{equation*}\n  \\Xvec_{[\\setJ]} \\xrightarrow{d} N\\big(\\zerovec_r, s^2 [\\diag(\\pvec_{[\\setJ]}) - \\pvec_{[\\setJ]}\\pvec_{[\\setJ]}^\\T]\\big),\n\\end{equation*}\nwhere $r=|\\setJ|$, $\\setJ=\\{j_1,\\ldots,j_r\\}$, $\\Xvec_{[\\setJ]}= (X_{j_1}, \\ldots, X_{j_r})^\\T$, and $\\pvec_{[\\setJ]} = (p_{\\cdot j_1}, \\ldots, p_{\\cdot j_r})^\\T$.\n\nSince $r < K$, the covariance matrix above is full-rank, and $[\\diag(\\pvec_{[\\setJ]}) - \\pvec_{[\\setJ]}\\pvec_{[\\setJ]}^\\T]^{-1} = \\diag(\\pvec_{[\\setJ]})^{-1} + q^{-1} \\onevec\\onevec^T$, where $\\onevec$ is a vector of ones of length $r$ and $q=1-\\sum_{j\\in\\setJ}p_{\\cdot j}$ \\citep{Tanabe92}. Then\n\\begin{align*}\n  W_{[\\setJ]} = &\\frac{1}{s^2}\\Xvec_{[\\setJ]}^\\T  \\big[\\diag(\\pvec_{[\\setJ]})^{-1} + \\frac{1}{q} \\onevec\\onevec^T\\big] \\Xvec_{[\\setJ]} \\\\\n  = & \\frac{1}{s^2}\\big[\\Xvec_{[\\setJ]}^\\T  \\diag(\\pvec_{[\\setJ]})^{-1} \\Xvec_{[\\setJ]} + \\frac{1}{q}  (\\Xvec_{[\\setJ]} \\onevec) (\\Xvec_{[\\setJ]} \\onevec) ^\\T\\big]\\\\\n  = &\\frac{1}{s^2}\\Big(\\sum_{j\\in\\setJ}\\frac{X_j^2}{p_{\\cdot j}} + \\frac{(\\sum_{j\\in\\setJ}X_j)^2}{q} \\Big)=  \\sum_{j\\in\\setJ} (1-p_{\\cdot j})T^2_j + \\big(\\sum_{j\\in\\setJ} p_{\\cdot j}\\big) T^2_\\setJ ,\n\\end{align*}\nand it has an asymptotically $\\chi^2_r$ distribution.\n\n\\end{proof}\n\nIntuitively, Theorem~\\ref{Th:partial} implies that the evidence against homogeneity for all elements of set $\\setJ$ consist of two parts: evidence against homogeneity for each individual element $j\\in\\setJ$ quantified by $T^2_j$, and evidence against homogeneity for $\\setJ$ as a whole quantified by $T^2_\\setJ$.\n\nTheorem~\\ref{Th:multitrend} is in fact a special case of Theorem~\\ref{Th:partial}: consider testing for trend in all but one outcome, i.e.\\ $\\setJ_0 = \\{1,\\ldots,K\\}\\setminus\\{j_0\\}$. Then $T_{\\setJ_0} = -T_{j_0}$, and $W_{\\setJ_0} =  \\sum_{j\\neq j_0} (1-p_{\\cdot j})T^2_j + (1-p_{\\cdot j_0}) T^2_{j_0} = W$. This fact is related to the logical restriction on the possible set of intersection hypotheses $H_\\setJ$: the homogeneity of any $K-1$ outcomes implies the homogeneity of all outcomes, thus $H_{0\\setJ} = H_0$ if $|\\setJ|=K-1$.\n\nIn a closed testing procedure an elementary hypothesis $H_{0j}$ is rejected if and only if all composite hypotheses $H_{0\\setJ}$, where $j\\in \\setJ$ are rejected \\citep{Marcus76}. The step-down process begins by testing the global null hypothesis $H_0$ using Theorem~\\ref{Th:multitrend}. If it is not rejected, the process stops, and no elementary hypotheses are rejected. Otherwise, all intersection hypotheses of size $K-2$ are tested using Theorem~\\ref{Th:partial}. Note that in a typical step-down procedure intersections of size $K-1$ would be considered, but in our case those are equivalent to $H_0$. Within the intersection hypotheses of size $K-2$ that are rejected, all intersection hypotheses of size $K-3$ are tested, etc. Whenever an intersection hypothesis is not rejected, none of its elementary hypotheses are rejected. The process can be rewritten using adjusted p-values \\citep{Wright92} for $H_{0j}, j=1,\\ldots K$:\n\\begin{equation}\\label{E:adjustp}\n    p^*_j = \\max_{\\setJ: j\\in \\setJ} p(\\setJ),\n\\end{equation}\nwhere $p(\\setJ) = P(W_j \\geq \\chi^2_{|\\setJ|})$ is the unadjusted p-value for testing $H_{0\\setJ}$. Then the $H_{0j}$ would be rejected, if $p^*_j\\leq \\alpha$, and the resulting procedure controls the family-wise error rate at $\\alpha$.\n\nFigure~\\ref{F:closed} shows all the hypothesis sets $\\setJ$ involved in the closed testing procedure for the stroke data. Note that the 4-element sets are not present due to the logical restriction discussed above. The p-value for the global null hypothesis $ABCDE$ was obtained using Theorem~\\ref{Th:multitrend}, while the partial null hypotheses were tested using Theorem~\\ref{Th:partial}. The adjusted p-value of the elementary hypothesis for outcome $C$ in the figure is based on the maximum p-value among all hypotheses containing $C$, which in this case happens to correspond to hypothesis $BCE$. Table~\\ref{T:strkres} shows the adjusted p-values for the other outcomes as well.\n\\begin{figure}\n  \\includegraphics[width=\\textwidth]{MultiCAtree-figure0}\n  \\caption{Closed testing with the stroke data. Each box represents a hypothesis test with the tested subset at the top, and the unadjusted p-value at the bottom. As an example, the hypotheses involving outcome $C$ are shaded gray, and the set providing the adjusted p-value has a thicker outline. $A$: Small vessel occlusion; $B$: Large artery atherosclerosis; $C$: Cardioembolism; $D$: Other determined aetiology; $E$: Undetermined aetiology.}\\label{F:closed}\n\\end{figure}\n\n\n% latex table generated in R 3.2.1 by xtable 1.7-4 package\n% Mon Nov  9 12:10:00 2015\n\\begin{table}[ht]\n\\caption{}\\label{T:strkres}\n\\centering\n\\begin{tabular}{rrrrrrrr}\n  \\hline\n &                    &        & \\multicolumn{5}{c}{p-value }\\\\ \\cline {4-8}\n & $\\hat{p}_{\\cdot j}$ & $T_j$ & raw & one-step & Holm & Holm2 & closed \\\\\n  \\hline\nSmall vessel occlusion & 0.293 & 1.20 & $2.3{\\scriptstyle \\times 10^{-1}}$ & $6.8{\\scriptstyle \\times 10^{-1}}$ & $4.6{\\scriptstyle \\times 10^{-1}}$ & $4.6{\\scriptstyle \\times 10^{-1}}$ & $2.3{\\scriptstyle \\times 10^{-1}}$ \\\\\n  Large artery atherosclerosis & 0.179 & 1.13 & $2.6{\\scriptstyle \\times 10^{-1}}$ & $7.2{\\scriptstyle \\times 10^{-1}}$ & $4.6{\\scriptstyle \\times 10^{-1}}$ & $4.6{\\scriptstyle \\times 10^{-1}}$ & $2.6{\\scriptstyle \\times 10^{-1}}$ \\\\\n  Cardioembolism & 0.302 & $-$5.16 & $2.4{\\scriptstyle \\times 10^{-7}}$ & $1.2{\\scriptstyle \\times 10^{-6}}$ & $1.2{\\scriptstyle \\times 10^{-6}}$ & $1.2{\\scriptstyle \\times 10^{-6}}$ & $5.8{\\scriptstyle \\times 10^{-6}}$ \\\\\n  Other determined aetiology & 0.037 & 4.28 & $1.9{\\scriptstyle \\times 10^{-5}}$ & $9.3{\\scriptstyle \\times 10^{-5}}$ & $7.6{\\scriptstyle \\times 10^{-5}}$ & $5.7{\\scriptstyle \\times 10^{-5}}$ & $3.3{\\scriptstyle \\times 10^{-5}}$ \\\\\n  Undetermined aetiology & 0.188 & 1.49 & $1.4{\\scriptstyle \\times 10^{-1}}$ & $4.8{\\scriptstyle \\times 10^{-1}}$ & $4.1{\\scriptstyle \\times 10^{-1}}$ & $4.1{\\scriptstyle \\times 10^{-1}}$ & $1.4{\\scriptstyle \\times 10^{-1}}$ \\\\\n   \\hline\n\\end{tabular}\n\\end{table}\n\n\\paragraph{Modified Holm's test}\nThe closed testing procedure framework provides an alternative approach for multiple testing adjustment: instead of using Theorem~\\ref{Th:partial} for testing the partial hypotheses $H_\\setJ$,  a Bonferroni-adjusted combination of the p-values of the tests of the elementary hypotheses can be used. This minP test uses $p(\\setJ) = |\\setJ| \\min_{j\\in\\setJ}p(j)$, where $p(j)$ is the p-value of the Cochran-Armitage trend-test for outcome $j$. With an unrestricted set of hypotheses this test reduces to Holm's procedure \\citep{Holm79}, while a generalization that includes restrictions was derived by \\citet{Shaffer86}.\n\n\\subsection{Power and sample size calculation}\n\nLet $\\nu_i=n_{i\\cdot}/N$ denote the proportion\nof subjects in group $i$. \n\n\\begin{theorem}\\label{Th:power}\nUnder $H_a$, the asymptotic distribution of $W$ is approximately $\\chi_{K-1}^2(\\lambda)$ with non-centrality parameter\n\\begin{equation}\\label{E:ncp}\n\t\\lambda = N  s_\\nu^2 \\sum_{j=1}^K \\frac{\\beta_j^2}{p_{\\cdot j}},\n\\end{equation}\nwhere $s_\\nu^2= \\sum_{i=1}^G \\nu_i(c_i-\\bar{c})^2=s^2/N$ and $\\beta_j=\\big[\\sum_{i=1}^G \\nu_{i}(p_{ij}-p_{\\cdot\n  j})(c_i-\\bar{c})\\big] /s_\\nu^2$ is the slope of $p_{ij}$, $i=1,\\ldots,G$ regressed on $c_i$ with weights $\\nu_i$.\n\\end{theorem}\n\n\\begin{proof}\nUsing the notations of Theorem~\\ref{Th:multitrend}, $\\Xvec\n\\xrightarrow{d} N\\big(\\muvec, \\Sigma)$, where $\\muvec=E(\\Xvec)$ and $\\Sigma=Var(\\Xvec)$\nare defined in \\eqref{E:MeanCov}. The test statistic $W=\\Xvec^T\n\\Sigma_0^+ \\Xvec$, where $\\Sigma_0=[\\diag(\\pvec)-\\pvec\\pvec^T]/s^2$,\ndoes not have an easily tracktable distribution in general, however an\napproximation can be obtained assuming $\\Sigma\\approx\\Sigma_0$. Then\n$W$ has an approximately non-central $\\chi^2$ distribution with\n$rank(\\Sigma_0)=K-1$ degrees of freedom and non-centrality parameter\n$\\lambda=\\muvec^T\\Sigma_0^+\\muvec$. Using the explicit form of\n$\\Sigma_0$ derived in Theorem~\\ref{Th:multitrend}, and that\n$\\muvec^T\\onevec=E(\\Xvec^T\\onevec)=E(0)=0$, we obtain\n$\\lambda=\\frac{1}{s^2}\\sum_{j=1}^K \\frac{\\mu_j^2}{p_{\\cdot j}}$. Finally, note that \n$\\mu_j = \\sum_i n_{i\\cdot}p_{ij}(c_i-\\bar{c}) = N\\sum_i\n\\nu_{i}p_{ij}(c_i-\\bar{c}) = N s_\\nu^2 \\beta_j = s^2 \\beta_j$,\nwhere $\\beta_j$ is defined in the statement of this theorem, and so\n$\\lambda=\\frac{1}{s^2}\\sum_{j=1}^K \\frac{s^4\\beta_j^2}{p_{\\cdot j}} =\ns^2 \\sum_{j=1}^K \\frac{\\beta_j^2}{p_{\\cdot j}}$.\n\\end{proof}\n\nTheorem~\\ref{Th:power} can be used to calculate the total sample size\nneeded to achieve power $1-\\beta$ at a significance level $\\alpha$,\nbased on the hypothesized average proportion of each outcome $p_{\\cdot\n  j}$, the corresponding slope of change $\\beta_j$, and the sample\nsize distribution defined by $\\nu_i$. Let $\\psi(k, \\alpha, \\beta)$\ndenote the non-centrality parameter of a chi-squared distribution with\n$k$ degrees of freedom for which $P(\\chi^2_l(\\psi) <\n\\chi^2_{l,\\alpha}) = \\beta$, where $\\chi^2_{l,\\alpha}$ denotes the\nupper $\\alpha$-th quantile of the central $\\chi^2_l$ distribution. The\nvalues of  $\\psi(k, \\alpha, \\beta)$  can be computed, for example\nusing the SAS function NCONCT. The required sample size can be\nobtained as\n\\begin{equation}\\label{E:ss}\nN = \\frac{\\psi(K-1, \\alpha, \\beta)}{s_\\nu^2 \\sum_{j=1}^K \\frac{\\beta_j^2}{p_{\\cdot j}}}\n\\end{equation}\n\n\\subsection{Relationship to other tests}\n\n\\section{Simulation studies}\nWe conducted multiple simulation studies investigating the type I\nerror rate control and validity of the power calculation theorem\n\\eqref{Th:power} in finite samples, and comparing the two\napproaches for testing individual outcomes. The simulation studies\npresented here have $G=5$ groups with equal group sizes. Linear scores $c_i=-2, -1, 0, 1,\n2$ were used in the tests. The outcome variable had $K=3, 5$, or $7$ possible\nvalues. The simulations were based on generating a variety of random patterns\nof the underlying matrices $[p_{ij}]$ of the probability of response in each\ngroup for fixed values of the\nnon-centrality parameter $\\lambda$ \\eqref{E:ncp}, including a value of\n0 under the null hypothesis. We obtained each random $[p_{ij}]$ matrix\nby first generating a vector of overall category probabilities\n$p_{\\cdot j}$, $j=1,\\ldots,K$ using a `stick-breaking process'-like\nrepresentation: a random sample of size $K-1$ from\nthe values $0.05, 0.10, 0.15, \\ldots, 0.95$ was selected without replacement, and\nthe desired probabilities were the lengths of the intervals between neighboring selected points (plus\nthe values 0 and 1).  Next, a random set of category-specific slopes\n$\\beta_j$ having a zero sum and giving the targeted non-centrality\nparameter $\\lambda$ was generated from the surface of the\n$(K-1)$-dimensional ellipsoid defined by these restrictions. When\n$\\lambda=0$ under the null hypothesis, $\\beta_j=0$ for all $j$.\nFinally, individual outcome probability values\nwere computed as $p_{ij}=p_{\\cdot j}  + \\beta_j [i - (G+1)/2]$. For\neach randomly generated outcome probability matrix one dataset was\ngenerated using the multinomial distribution in each group $i$,\n$i=1,\\ldots, G$, and the proposed test was performed. For each value\nof the non-centrality parameter $R=5000$ random matrices $[p_{ij}]$\nwere generated (except $R=1000$ for the overall\ntest power study), and the power was computed as the proportion of\nsamples with p-value exceeding 0.05, the target significance level. \n\n\n\\subsection{Type I error of the overall test}\nFirst, we examined the type I error control of the overall test\n\\ref{E:multitrend} for finite sample sizes. Figure~\\ref{F:typeI}\nshows the results as $n_{i\\cdot}$, the sample size per group, \nwas varied from 10 to 100 in increments of 5. We can see that the test\nis conservative for small sample sizes, but  reaches the target\nsignificance level when the expected number per cell, $n_{i\\cdot}/K$ is 4 or above. \n\n\\begin{figure}\n  \\includegraphics[width=\\textwidth]{TypeISim}\n  \\caption{Simulated type I error of the overall test as a function of sample\n    size. Error bars represent 95\\% confidence intervals.}\\label{F:typeI}\n\\end{figure}\n\n\\subsection{Power of the overall test}\nWe simulated the power of the overall test \\ref{E:multitrend} for integer\nvalues of the non-centrality parameter $\\lambda$ ranging from 0 to 30,\nand sample sizes of 10, 50, and 100 per group. Figure~\\ref{F:power}\nshows the agreement between the theoretical values based on\nTheorem~\\ref{Th:power} and simulated values. The agreement is very\ngood for the larger sample sizes, however the approximation off by 5\npercentage points or more with 10 observations per group, especially\nas the number of categories increases. In this case the actual power is below the\nformula-based value for small values of the non-centrality parameter\nand above for larger values, indicating that the distribution of the\ntest statistic $W$ is overdispersed compared to the non-central\nchi-square approximation.\n\n\\begin{figure}\n  \\includegraphics[width=\\textwidth]{PowerSim2}\n  \\caption{Simulated versus calculated power of the overall test as a function of the\n    sample size. Error bars represent 95\\% confidence intervals, the\n    solid line represents equality.}\\label{F:power}\n\\end{figure}\n\n\\subsection{Simulations of the individual outcome tests}\nFinally, we simulated data with a mixture of false and true\noutcome-specific null-hypotheses $H_{0j}$ to compare the type I\nerror control and power of the the proposed approaches for testing the\nindividual outcomes. The group sample size was set to 100. In each simulation we kept the overall power\nconstant by fixing the non-centrality parameter at integer values 0 to\n30 as above, but ensured that a\ncertain number of the null-hypotheses were true by setting their\n$\\beta_j$ to zero.  Figure~\\ref{F:indiv_typeI} shows the The\nfamilywise error rates in this simulation, which was defined as the\nprobability of p-value below 0.05 for at least one of the true\noutcome-specific null hypotheses. Both the closed testing and\nSchaffer-Holm procedures provide a conservative control of the type I error,\nand the conservativeness decreases with increasing non-centrality\nparameter and with a larger number of true null\nhypotheses. Interestingly, the simpler Schaffer-Holm procedure appears\nto be less conservative, especially as the number of outcomes increases.\n\n\\begin{figure}\n  \\includegraphics[width=\\textwidth]{IndivTypeISim}\n  \\caption{Simulated familywise type I error of the indvidual\n    outcome-specific tests as a function of the non-centrality\n    parameter and the number of false null hypotheses. Error bars represent 95\\% confidence intervals.}\\label{F:indiv_typeI}\n\\end{figure}\n\nBased on the same set of simulations we compared the power of the two\napproaches by estimating the average number of rejections among the\nfalse null hypotheses. Figure~\\ref{F:indiv_power} shows the difference\nin the number of rejections between the two methods. There is no\ndifference between the two methods when the non-centrality parameter\nis small, and so the number of rejection is low for both methods, or\nwhen it is high, and both methods reject every false\nhypothesis. However in intermediate situations, consistently with\nthe findings for the type I error rate, with $K=3$ outcomes the closed\nset testing is more powerful, and with more outcomes the Schaffer-Holm\nprocedure achieves more rejections on average.\n\n\\begin{figure}\n  \\includegraphics[width=\\textwidth]{IndivPowerSim}\n  \\caption{Simulated difference in the number of rejections among the\n    false individual null hypotheses as a function of non-centrality\n    parameter and the number of false null hypotheses. Error bars represent 95\\% confidence intervals.}\\label{F:indiv_power}\n\\end{figure}\n\n\n\n\\bibliographystyle{Chicago}\n\\bibliography{MultiCA}\n\\end{document}\n",
    "created" : 1461860344265.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2601860052",
    "id" : "D4D07AD0",
    "lastKnownWriteTime" : 1461786395,
    "path" : "Z:/EOGeorge/MultiTrend/MultiCA.tex",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "tex"
}